<!-- sidenav container title -->
<div class="sidenav-container-header">
  <div class="sidenav-header">
    {{ createWorkordersHeader() | titlecase }}
  </div>
</div>

<mat-sidenav-container [hasBackdrop]="false" class="sidenav-container">
  <!-- left sidenav -->
  <mat-sidenav
    #leftSidenav
    class="left-sidenav sidenav"
    mode="side"
    position="start"
    [(opened)]="showLeftSidenav"
    (opened)="closeRightSidenav()"
  >
    <!-- filter workorders -->
    <div class="filter-workorders">
      <div class="filter-workorders-text-and-icon">
        <div class="filter-workorders-text fw-bold">Filter</div>
        <div class="filter-workorders-icon">
          <mat-icon
            (click)="showWorkordersFilterOptions = !showWorkordersFilterOptions"
            >filter_list</mat-icon
          >
        </div>
      </div>
      <div
        *ngIf="showWorkordersFilterOptions"
        class="filter-workorders-options"
      >
        <mat-form-field>
          <mat-label>Filter Options</mat-label>
          <mat-select
            #filterWorkordersOptionsField
            (selectionChange)="
              filterWorkordersByDateRaised(filterWorkordersOptionsField.value)
            "
          >
            <mat-option value="None">None</mat-option>
            <mat-option value="Today">Today</mat-option>
            <mat-option value="Yesterday">Yesterday</mat-option>
            <mat-option value="This Week">This Week</mat-option>
            <mat-option value="Last Week">Last Week</mat-option>
            <mat-option value="This Month">This Month</mat-option>
            <mat-option value="Last Month">Last Month</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- filter value -->
    <div
      *ngIf="filterOption && filterOption !== 'None'"
      class="filter-field-value"
    >
      <div class="filter-value" style="text-decoration: underline">
        {{ filterOption }}'s W/o's
      </div>
    </div>

    <!-- sidenav header -->
    <div class="sidenav-heading-container left-sidenav-heading">
      <div class="sidenav-heading">
        <h2>Workorders</h2>
      </div>
    </div>

    <!-- loading workorders -->
    <div *ngIf="loadingWorkorders">
      <div class="workorders-sidenav-text-container">
        <div class="loading-workorders workorders-sidenav-text">
          Loading workorders...
        </div>
      </div>
    </div>

    <!-- loading workorders failed -->
    <div *ngIf="!loadingWorkorders && loadingWorkordersFailed">
      <div class="workorders-sidenav-text-container">
        <div
          class="loading-workorders workorders-sidenav-text"
          style="color: red"
        >
          Loading workorders failed.
        </div>
      </div>
    </div>

    <!-- workorders loaded -->
    <div
      *ngIf="
        !loadingWorkorders && !loadingWorkordersFailed && workordersToDisplay
      "
    >
      <!-- no pending workorders -->
      <div *ngIf="workordersToDisplay.length === 0">
        <div class="workorders-sidenav-text-container">
          <div class="workorders-sidenav-text">No workorders to display.</div>
        </div>
      </div>

      <!-- pending workorders -->
      <div *ngIf="workordersToDisplay.length !== 0">
        <div class="display-workorder-numbers">
          <mat-action-list role="list">
            <!-- corrective maintenance workorders -->
            <div
              *ngIf="
                filterWorkordersByType(
                  'Corrective Maintenance'
                ) as correctiveMaintenanceWorkorders
              "
            >
              <div *ngIf="correctiveMaintenanceWorkorders.length !== 0">
                <div class="workorder-numbers">
                  <div mat-subheader class="workorders-subheader">
                    Corrective Mtnc
                  </div>
                </div>
                <mat-list-item
                  role="listitem"
                  *ngFor="
                    let workorder of correctiveMaintenanceWorkorders;
                    let last = last
                  "
                >
                  <button
                    type="button"
                    class="action-button btn btn-link shadow-none"
                    (click)="displayWorkorder(workorder.workorder.number)"
                  >
                    <span
                      class="d-inline-block text-truncate"
                      style="max-width: 100px"
                      >{{
                        workorder.raised.dateTime | formatWorkorderNumber
                      }}</span
                    >
                  </button>
                  <mat-divider *ngIf="!last"></mat-divider>
                </mat-list-item>
                <mat-divider class="mb-2"></mat-divider>
              </div>
            </div>

            <!-- breakdown workorders -->
            <div
              *ngIf="filterWorkordersByType('Breakdown') as breakdownWorkorders"
            >
              <div *ngIf="breakdownWorkorders.length !== 0">
                <div class="workorder-numbers">
                  <div mat-subheader class="workorders-subheader">
                    Breakdown
                  </div>
                </div>
                <mat-list-item
                  role="listitem"
                  *ngFor="let workorder of breakdownWorkorders; let last = last"
                >
                  <button
                    type="button"
                    class="action-button btn btn-link shadow-none"
                    (click)="displayWorkorder(workorder.workorder.number)"
                  >
                    <span
                      class="d-inline-block text-truncate"
                      style="max-width: 100px"
                      >{{
                        workorder.raised.dateTime | formatWorkorderNumber
                      }}</span
                    >
                  </button>
                  <mat-divider *ngIf="!last"></mat-divider>
                </mat-list-item>
                <mat-divider class="mb-2"></mat-divider>
              </div>
            </div>

            <!-- tool change workorders -->
            <div
              *ngIf="
                filterWorkordersByType('Tool Change') as toolChangeWorkorders
              "
            >
              <div *ngIf="toolChangeWorkorders.length !== 0">
                <div class="workorder-numbers">
                  <div mat-subheader class="workorders-subheader">
                    Tool Change
                  </div>
                </div>
                <mat-list-item
                  role="listitem"
                  *ngFor="
                    let workorder of toolChangeWorkorders;
                    let last = last
                  "
                >
                  <button
                    type="button"
                    class="action-button btn btn-link shadow-none"
                    (click)="displayWorkorder(workorder.workorder.number)"
                  >
                    <span
                      class="d-inline-block text-truncate"
                      style="max-width: 100px"
                      >{{
                        workorder.raised.dateTime | formatWorkorderNumber
                      }}</span
                    >
                  </button>
                  <mat-divider *ngIf="!last"></mat-divider>
                </mat-list-item>
                <mat-divider class="mb-2"></mat-divider>
              </div>
            </div>

            <!-- am workorders -->
            <div *ngIf="filterWorkordersByType('AM') as amWorkorders">
              <div *ngIf="amWorkorders.length !== 0">
                <div class="workorder-numbers">
                  <div mat-subheader class="workorders-subheader">AM</div>
                </div>
                <mat-list-item
                  role="listitem"
                  *ngFor="let workorder of amWorkorders; let last = last"
                >
                  <button
                    type="button"
                    class="action-button btn btn-link shadow-none"
                    (click)="displayWorkorder(workorder.workorder.number)"
                  >
                    <span
                      class="d-inline-block text-truncate"
                      style="max-width: 100px"
                      >{{
                        workorder.raised.dateTime | formatWorkorderNumber
                      }}</span
                    >
                  </button>
                  <mat-divider *ngIf="!last"></mat-divider>
                </mat-list-item>
                <mat-divider class="mb-2"></mat-divider>
              </div>
            </div>

            <!-- pm workorders -->
            <div *ngIf="filterWorkordersByType('PM') as pmWorkorders">
              <div *ngIf="pmWorkorders.length !== 0">
                <div class="workorder-numbers">
                  <div mat-subheader class="workorders-subheader">PM</div>
                </div>
                <mat-list-item
                  role="listitem"
                  *ngFor="let workorder of pmWorkorders; let last = last"
                >
                  <button
                    type="button"
                    class="action-button btn btn-link shadow-none"
                    (click)="displayWorkorder(workorder.workorder.number)"
                  >
                    <span
                      class="d-inline-block text-truncate"
                      style="max-width: 100px"
                      >{{
                        workorder.raised.dateTime | formatWorkorderNumber
                      }}</span
                    >
                  </button>
                  <mat-divider *ngIf="!last"></mat-divider>
                </mat-list-item>
                <mat-divider class="mb-2"></mat-divider>
              </div>
            </div>

            <!-- abnormality card workorders -->
            <div
              *ngIf="
                filterWorkordersByType(
                  'Abnormality Card'
                ) as abnormalityCardWorkorders
              "
            >
              <div *ngIf="abnormalityCardWorkorders.length !== 0">
                <div class="workorder-numbers">
                  <div mat-subheader class="workorders-subheader">
                    Abnormality Card
                  </div>
                </div>
                <mat-list-item
                  role="listitem"
                  *ngFor="
                    let workorder of abnormalityCardWorkorders;
                    let last = last
                  "
                >
                  <button
                    type="button"
                    class="action-button btn btn-link shadow-none"
                    (click)="displayWorkorder(workorder.workorder.number)"
                  >
                    <span
                      class="d-inline-block text-truncate"
                      style="max-width: 100px"
                      >{{
                        workorder.raised.dateTime | formatWorkorderNumber
                      }}</span
                    >
                  </button>
                  <mat-divider *ngIf="!last"></mat-divider>
                </mat-list-item>
                <mat-divider class="mb-2"></mat-divider>
              </div>
            </div>

            <!-- mold service workorders -->
            <div
              *ngIf="
                filterWorkordersByType('Mold Service') as moldServiceWorkorders
              "
            >
              <div *ngIf="moldServiceWorkorders.length !== 0">
                <div class="workorder-numbers">
                  <div mat-subheader class="workorders-subheader">
                    Mold Service
                  </div>
                </div>
                <mat-list-item
                  role="listitem"
                  *ngFor="
                    let workorder of moldServiceWorkorders;
                    let last = last
                  "
                >
                  <button
                    type="button"
                    class="action-button btn btn-link shadow-none"
                    (click)="displayWorkorder(workorder.workorder.number)"
                  >
                    <span
                      class="d-inline-block text-truncate"
                      style="max-width: 100px"
                      >{{
                        workorder.raised.dateTime | formatWorkorderNumber
                      }}</span
                    >
                  </button>
                  <mat-divider *ngIf="!last"></mat-divider>
                </mat-list-item>
                <mat-divider class="mb-2"></mat-divider>
              </div>
            </div>

            <!-- service workorders -->
            <div *ngIf="filterWorkordersByType('Service') as serviceWorkorders">
              <div *ngIf="serviceWorkorders.length !== 0">
                <div class="workorder-numbers">
                  <div mat-subheader class="workorders-subheader">Service</div>
                </div>
                <mat-list-item
                  role="listitem"
                  *ngFor="let workorder of serviceWorkorders; let last = last"
                >
                  <button
                    type="button"
                    class="action-button btn btn-link shadow-none"
                    (click)="displayWorkorder(workorder.workorder.number)"
                  >
                    <span
                      class="d-inline-block text-truncate"
                      style="max-width: 100px"
                      >{{
                        workorder.raised.dateTime | formatWorkorderNumber
                      }}</span
                    >
                  </button>
                  <mat-divider *ngIf="!last"></mat-divider>
                </mat-list-item>
                <mat-divider class="mb-2"></mat-divider>
              </div>
            </div>

            <!-- kaizen card workorders -->
            <div
              *ngIf="
                filterWorkordersByType('Kaizen Card') as kaizenCardWorkorders
              "
            >
              <div *ngIf="kaizenCardWorkorders.length !== 0">
                <div class="workorder-numbers">
                  <div mat-subheader class="workorders-subheader">
                    Kaizen Card
                  </div>
                </div>
                <mat-list-item
                  role="listitem"
                  *ngFor="
                    let workorder of kaizenCardWorkorders;
                    let last = last
                  "
                >
                  <button
                    type="button"
                    class="action-button btn btn-link shadow-none"
                    (click)="displayWorkorder(workorder.workorder.number)"
                  >
                    <span
                      class="d-inline-block text-truncate"
                      style="max-width: 100px"
                      >{{
                        workorder.raised.dateTime | formatWorkorderNumber
                      }}</span
                    >
                  </button>
                  <mat-divider *ngIf="!last"></mat-divider>
                </mat-list-item>
                <mat-divider class="mb-2"></mat-divider>
              </div>
            </div>

            <!-- project workorders -->
            <div *ngIf="filterWorkordersByType('Project') as projectWorkorders">
              <div *ngIf="projectWorkorders.length !== 0">
                <div class="workorder-numbers">
                  <div mat-subheader class="workorders-subheader">Project</div>
                </div>
                <mat-list-item
                  role="listitem"
                  *ngFor="let workorder of projectWorkorders; let last = last"
                >
                  <button
                    type="button"
                    class="action-button btn btn-link shadow-none"
                    (click)="displayWorkorder(workorder.workorder.number)"
                  >
                    <span
                      class="d-inline-block text-truncate"
                      style="max-width: 100px"
                      >{{
                        workorder.raised.dateTime | formatWorkorderNumber
                      }}</span
                    >
                  </button>
                  <mat-divider *ngIf="!last"></mat-divider>
                </mat-list-item>
                <mat-divider class="mb-2"></mat-divider>
              </div>
            </div>
          </mat-action-list>
        </div>
      </div>
    </div>
  </mat-sidenav>

  <!-- right sidenav -->
  <mat-sidenav
    #rightSidenav
    class="right-sidenav sidenav"
    mode="side"
    position="end"
    [(opened)]="showRightSidenav"
    (opened)="closeLeftSidenav()"
  >
    <app-workorder-actions
      [selectedWorkorder]="workorder"
      [userType]="userType"
      [userUid]="userUid"
      [workordersType]="workordersType"
      (showModal)="toggleModal($event)"
      (updateWorkorder)="updateWorkorder($event)"
    ></app-workorder-actions>
  </mat-sidenav>

  <!-- main sidenav content -->
  <mat-sidenav-content class="sidenav-content-container">
    <!-- loading workorders -->
    <div *ngIf="loadingWorkorders">
      <div class="loading-workorders-bootstrap-spinner">
        <div
          #loadingWorkordersSpinner
          class="spinner-border"
          style="width: 3rem; height: 3rem"
          role="status"
        ></div>

        <div class="loading-workorders-spinner-text">
          <strong>Loading workorders...</strong>
        </div>
      </div>
    </div>

    <!-- error loading workorders -->
    <div *ngIf="!loadingWorkorders && loadingWorkordersFailed">
      <div class="no-workorders-to-display" style="color: red">
        <p>
          {{
            loadingWorkordersIndexingError
              ? loadingWorkordersIndexingError
              : loadingWorkordersOtherError
              ? loadingWorkordersOtherError
              : loadingWorkordersDefaultError
          }}
        </p>
      </div>
    </div>

    <!-- loading workorders done -->
    <div
      *ngIf="
        !loadingWorkorders && !loadingWorkordersFailed && workordersToDisplay
      "
    >
      <!-- no workorders -->
      <div *ngIf="workordersToDisplay.length === 0">
        <div class="no-workorders-to-display">
          <p>There are no workorders to display.</p>
        </div>
      </div>

      <!-- workorders present -->
      <div *ngIf="workordersToDisplay.length !== 0">
        <!-- no workorder selected in left pane -->
        <div *ngIf="!workorder">
          <div class="no-workorders-to-display">
            <p>
              <span class="text-decoration-underline">Select</span> a workorder
              in the
              <span class="text-decoration-underline">left pane</span>
              to view details.
            </p>
            <p *ngIf="workorderHasActions">
              The available
              <span class="text-decoration-underline">actions</span> for the
              workorder will be in the
              <span class="text-decoration-underline">right pane.</span>
              Click on <strong>Help?</strong> to get a guideline on what each of
              the actions does.
            </p>
          </div>
        </div>

        <!-- workorder selected in left pane -->
        <div *ngIf="workorder">
          <div class="workorder-selected-container">
            <!-- toggle sidenavs status -->
            <div class="toggle-sidenavs-status">
              <!-- workorder has actions -->
              <div *ngIf="workorderHasActions">
                <div class="workorder-has-actions">
                  <button
                    class="toggle-left-sidenav toggle-sidenav-button"
                    mat-icon-button
                    type="button"
                    (click)="leftSidenav.toggle()"
                  >
                    <mat-icon *ngIf="showLeftSidenav">chevron_left</mat-icon>
                    <mat-icon *ngIf="!showLeftSidenav">chevron_right</mat-icon>
                  </button>

                  <button
                    class="toggle-right-sidenav toggle-sidenav-button"
                    mat-icon-button
                    type="button"
                    (click)="rightSidenav.toggle()"
                  >
                    <mat-icon *ngIf="showRightSidenav">chevron_right</mat-icon>
                    <mat-icon *ngIf="!showRightSidenav">chevron_left</mat-icon>
                  </button>
                </div>
              </div>

              <!-- workorder has no actions -->
              <div *ngIf="!workorderHasActions">
                <div class="workorder-has-no-actions">
                  <button
                    class="toggle-left-sidenav toggle-sidenav-button"
                    mat-icon-button
                    type="button"
                    (click)="showLeftSidenav = !showLeftSidenav"
                  >
                    <mat-icon *ngIf="showLeftSidenav">chevron_left</mat-icon>
                    <mat-icon *ngIf="!showLeftSidenav">chevron_right</mat-icon>
                  </button>
                </div>
              </div>
            </div>

            <!-- workorder form -->
            <div class="display-workorder">
              <div class="form-container mat-elevation-z5">
                <app-workorder
                  [workorder]="workorder"
                  [user]="userType"
                  (updateWorkorder)="updateWorkorder($event)"
                ></app-workorder>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>

<!-- help modal -->
<div *ngIf="showHelpModal && workorder">
  <app-help-modal
    [user]="userType"
    [workorder]="workorder"
    (close)="toggleModal($event)"
  >
  </app-help-modal>
</div>

<!-- SUPERVISORS -->
<!-- reject workorder -->
<div *ngIf="showRejectWorkorderModal && workorder">
  <app-reject-workorder-modal
    [workorder]="workorder"
    (close)="toggleModal($event)"
  ></app-reject-workorder-modal>
</div>

<!-- superisor handover -->
<div *ngIf="showSupervisorsHandoverModal && workorder && supervisors">
  <app-supervisors-handover-modal
    [workorder]="workorder"
    [supervisors]="supervisors"
    (close)="toggleModal($event)"
  ></app-supervisors-handover-modal>
</div>

<!-- change technicians -->
<div *ngIf="showChangeTechniciansModal && workorder && technicians">
  <app-change-technicians-modal
    [workorder]="workorder"
    [technicians]="technicians"
    (close)="toggleModal($event)"
  ></app-change-technicians-modal>
</div>

<!-- assign technicians -->
<div *ngIf="showAssignTechniciansModal && workorder && technicians">
  <app-assign-technicians-modal
    [workorder]="workorder"
    [technicians]="technicians"
    (close)="toggleModal($event)"
  ></app-assign-technicians-modal>
</div>

<!-- TECHNICIANS -->
<!-- eng handover -->
<div *ngIf="showEngTechnicianHandoverModal && workorder && technicians">
  <app-technicians-handover-modal
    [workorder]="workorder"
    [technicians]="technicians"
    (close)="toggleModal($event)"
  ></app-technicians-handover-modal>
</div>

<!-- stores handover -->
<div *ngIf="showStoreTechnicianHandoverModal && workorder">
  <app-store-technicians-handover-modal
    [workorder]="workorder"
    [technicians]="technicians"
    (close)="toggleModal($event)"
  ></app-store-technicians-handover-modal>
</div>

<!-- MANAGERS - ENG -->
<!-- review workorders -->
<div *ngIf="showReviewWorkordersModal && workorders">
  <app-review-workorders-modal
    [workorders]="workorders"
    (close)="toggleModal($event)"
  ></app-review-workorders-modal>
</div>

<!-- raise concerns -->
<div *ngIf="showRaiseConcernsModal && workorder">
  <app-raise-concern-modal
    [workorder]="workorder"
    (close)="toggleModal($event)"
  ></app-raise-concern-modal>
</div>
