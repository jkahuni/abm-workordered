<div class="chart-container-wrapper" *ngIf="!loadingWorkordersFailed">
  <!-- spinner -->
  <div *ngIf="loading" class="chart-container">
    <div class="bootstrap-spinner-container-wrapper">
      <div class="bootstrap-spinner-container">
        <div class="bootstrap-spinner">
          <div
            #loadingSpinner
            class="spinner-border"
            style="width: 2rem; height: 2rem"
            role="status"
          ></div>
          <span class="loading-tag"><strong>Plotting Chart...</strong></span>
        </div>
      </div>
    </div>
  </div>

  <!-- canvas objects -->
  <!-- mean time to approve charts -->
  <ng-container *ngIf="meanTimeToApprove">
    <app-approve-multiple-sections-one-month
      *ngIf="showApproveMultipleSectionsOneMonth"
      class="chart-container"
      [workorders]="workorders"
      [sections]="sections"
      [dateIndicesObject]="dateIndicesObject"
      [viableWorkorders]="viableWorkorders"
      (chartPlotted)="updateChartPlottedStatus($event)"
      (switchChart)="switchChart($event)"
    ></app-approve-multiple-sections-one-month>

    <app-approve-one-section-multiple-months
      *ngIf="showApproveOneSectionMultipleMonths"
      class="chart-container"
      [workorders]="workorders"
      [section]="section"
      [viableWorkorders]="viableWorkorders"
      [dateIndicesObject]="dateIndicesObject"
      [totalMonthsPeriod]="totalMonthsPeriod"
      [useCustomRange]="useCustomRange"
      [dateRangeLimits]="dateRangeLimits"
      [defaultYearIndex]="defaultYearIndex"
      [defaultMonthIndex]="defaultMonthIndex"
      (chartPlotted)="updateChartPlottedStatus($event)"
      (switchChart)="switchChart($event)"
      (updateDateRangeLimits)="updateDateRangeLimitsFromChild($event)"
    ></app-approve-one-section-multiple-months>
  </ng-container>

  <!-- filter fields -->
  <div *ngIf="chartPlotted" class="filter-charts">
    <!-- select chart type -->
    <div class="select-chart-type">
      <div class="filter-charts-label">Change Charts</div>

      <!-- change chart metrics -->
      <div class="filter-chart-field">
        <mat-form-field class="filter-chart-form-field" appearance="outline">
          <mat-label>Select Metrics</mat-label>
          <mat-select
            [(ngModel)]="chartsType"
            (selectionChange)="changeChartsType($event.value)"
          >
            <mat-option value="mean-time-to-approve">
              Mean Time To Approve</mat-option
            >
          </mat-select>
        </mat-form-field>
      </div>

      <!-- change type of chart -->
      <div class="filter-chart-field">
        <mat-form-field class="filter-chart-form-field" appearance="outline">
          <mat-label>Select Chart</mat-label>
          <mat-select
            [(ngModel)]="chartType"
            (selectionChange)="changeChartType($event.value)"
          >
            <mat-option value="approve-multiple-sections-one-month">
              Sections - 1 Month
            </mat-option>
            <mat-option value="approve-one-section-multiple-months">
              1 Section - Many Months
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- divide the two parts -->
    <!-- hidden in small screens -->
    <div class="divide-filter-chart-parts">
      <mat-divider></mat-divider>
    </div>

    <!-- filter charts -->
    <div class="filter-chart-parameters">
      <div class="filter-charts-label">Change Chart Values</div>

      <!-- filter multiple sections one month -->
      <ng-container *ngIf="showApproveMultipleSectionsOneMonth">
        <!-- select multiple sections -->
        <div class="filter-chart-field">
          <mat-form-field class="filter-chart-form-field" appearance="outline">
            <mat-label>Change Sections</mat-label>
            <mat-select
              multiple
              [(ngModel)]="sections"
              (selectionChange)="updateSections($event.value)"
            >
              <mat-select-trigger>
                {{ sections ? sections[0]["formattedName"] : "" }}
                <span
                  *ngIf="sections && sections.length > 1"
                  class="select-multiple-sections-trigger"
                >
                  (+{{ sections && sections.length - 1 }}
                  {{
                    sections && sections.length === 2 ? "other" : "others"
                  }})</span
                >
              </mat-select-trigger>

              <mat-option
                *ngFor="let section of factorySections"
                [value]="section"
                >{{ section.name }}</mat-option
              >
            </mat-select>
          </mat-form-field>
        </div>

        <!-- filter years -->
        <div class="filter-chart-field">
          <mat-form-field class="filter-chart-form-field" appearance="outline">
            <mat-label>Change Year</mat-label>
            <mat-select
              [(ngModel)]="year"
              (selectionChange)="updateYear($event.value)"
            >
              <mat-option *ngFor="let year of years" [value]="year">{{
                year
              }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- filter months -->
        <div class="filter-chart-field">
          <mat-form-field class="filter-chart-form-field" appearance="outline">
            <mat-label>Change Month</mat-label>
            <mat-select
              [(ngModel)]="month"
              (selectionChange)="updateMonth($event.value)"
            >
              <mat-option
                *ngFor="let month of months"
                value="{{ month.formattedName }}"
                >{{ month.name }}</mat-option
              >
            </mat-select>
          </mat-form-field>
        </div>
      </ng-container>

      <!-- filter one section multiple months -->
      <ng-container *ngIf="showApproveOneSectionMultipleMonths">
        <!-- filter section -->
        <div
          class="filter-chart-field"
          *ngIf="showApproveOneSectionMultipleMonths"
        >
          <mat-form-field class="filter-chart-form-field" appearance="outline">
            <mat-label>Change Section</mat-label>
            <mat-select
              [(ngModel)]="section"
              (selectionChange)="updateSection($event.value)"
            >
              <mat-option
                *ngFor="let section of factorySections"
                value="{{ section.name }}"
                >{{ section.name }}</mat-option
              >
            </mat-select>
          </mat-form-field>
        </div>
      
        <!-- change total months period -->
        <ng-container *ngIf="!useCustomRange">
          <div class="filter-chart-field">
            <mat-form-field
              class="filter-chart-form-field"
              appearance="outline"
            >
              <mat-label>Change Total Months</mat-label>
              <mat-select
                [(ngModel)]="totalMonthsPeriod"
                (selectionChange)="updateTotalMonthsPeriod($event.value)"
              >
                <mat-option
                  *ngFor="let period of totalMonthPeriods"
                  [value]="period"
                  >{{ period }}</mat-option
                >
              </mat-select>
            </mat-form-field>
          </div>
        </ng-container>

        <div class="filter-chart-field slider-toggle">
          <mat-slide-toggle
            color="primary"
            (change)="updateUseCustomRange($event)"
            aria-labelledby="filter chart using custom dates"
            >{{
              useCustomRange ? "Custom dates" : "Custom dates?"
            }}</mat-slide-toggle
          >
        </div>

        <!-- change date range parts -->
        <ng-container *ngIf="useCustomRange">
          <!-- first year -->
          <div class="filter-chart-field">
            <mat-form-field
              class="filter-chart-form-field"
              appearance="outline"
            >
              <mat-label>Change First Year</mat-label>
              <mat-select
                [(ngModel)]="firstYear"
                (selectionChange)="
                  updateDateRangeLimitParts($event.value, 'first-year')
                "
              >
                <mat-option *ngFor="let year of years" [value]="year">{{
                  year
                }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- first month -->
          <div class="filter-chart-field">
            <mat-form-field
              class="filter-chart-form-field"
              appearance="outline"
            >
              <mat-label>Change First Month</mat-label>
              <mat-select
                [(ngModel)]="firstMonth"
                (selectionChange)="
                  updateDateRangeLimitParts($event.value, 'first-month')
                "
              >
                <mat-option
                  *ngFor="let month of months"
                  value="{{ month.formattedName }}"
                  >{{ month.name }}</mat-option
                >
              </mat-select>
            </mat-form-field>
          </div>

          <!-- last year -->
          <div class="filter-chart-field">
            <mat-form-field
              class="filter-chart-form-field"
              appearance="outline"
            >
              <mat-label>Change Last Year</mat-label>
              <mat-select
                [(ngModel)]="lastYear"
                (selectionChange)="
                  updateDateRangeLimitParts($event.value, 'last-year')
                "
              >
                <mat-option *ngFor="let year of years" [value]="year">{{
                  year
                }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- last month -->
          <div class="filter-chart-field">
            <mat-form-field
              class="filter-chart-form-field"
              appearance="outline"
            >
              <mat-label>Change Last Month</mat-label>
              <mat-select
                [(ngModel)]="lastMonth"
                (selectionChange)="
                  updateDateRangeLimitParts($event.value, 'last-month')
                "
              >
                <mat-option
                  *ngFor="let month of months"
                  value="{{ month.formattedName }}"
                  >{{ month.name }}</mat-option
                >
              </mat-select>
            </mat-form-field>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </div>
</div>

<div *ngIf="loadingWorkordersFailed" class="chart-container-wrapper">
  <div class="chart-container">
    {{
      indexingError ? indexingError : otherError ? otherError : fallbackError
    }}
  </div>
</div>
